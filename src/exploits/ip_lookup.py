from urllib.request import urlopen
from prettytable import PrettyTable
from json import loads
from Webcrawler import WebCrawler

colors = {
    'BLUE': '\33[1;94m',
    'RED': '\033[1;91m',
    'WHITE': '\33[1;97m',
    'YELLOW': '\33[1;93m',
    'MAGENTA': '\033[1;35m',
    'GREEN': '\033[1;32m',
    'END': '\033[0m',
}


class IPLookUp(WebCrawler):

    global colors

    def __init__(self, ipAddress):
        self.ipAddress = ipAddress

    def getInformation(self):
        # JSON FILE using Freegeoip API

        request = urlopen("https://freegeoip.net/json/"+str(self.ipAddress))
        request = request.read().decode("utf-8")
        jsonFile = loads(request)

        region = jsonFile['region_name']
        countryCode = jsonFile['country_code']
        latitude = jsonFile['latitude']
        longitude = jsonFile['longitude']
        ipAddr = jsonFile['ip']
        zipCode = jsonFile['zip_code']
        timeZone = jsonFile['time_zone']
        countryName = jsonFile['country_name']
        city = jsonFile['city']

        table = PrettyTable()
        table.field_names = [
            "Region", "Country Code", "Latitude",
            "Longitude", "IP Address", "Zip Code",
            "Time Zone", "Country", "City"
        ]
        table.add_row(
            [
                region, countryCode, latitude,
                longitude, ipAddr, zipCode,
                timeZone, countryName, city
                ]
        )
        # align to the right
        table.align = "r"
        print(colors["MAGENTA"], table, colors["END"])
